<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>一盏好看的台灯详情 - 织梦商城模板-dedehtml.com</title>
    <meta name="keywords" content="一盏,好,看的,台灯,">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link rel="stylesheet" href="../res/layui/css/layui.css">
    <link rel="stylesheet" href="../res/static/css/index.css">
</head>
<body>
<div class="house-header">
    <div class="layui-container">
        <div class="house-nav"><span class="layui-breadcrumb memberinfo" lay-separator="|">
            <a href="../member/login.html" id="turnLogin"><label id="username_bar"></label></a>
              <a href="" id="logout">退出</a>
        </span>
           </div>
        <div class="house-banner layui-form"><a class="banner" href="/"><img src="../res/static/img/logo.png"
                                                                             alt="织梦商城模板-dedehtml.com"></a>
            <div class="layui-input-inline"><input type="text" placeholder="搜索好物" class="layui-input"><i
                    class="layui-icon layui-icon-house-find"></i></div>
            <a class="shop" href="../car/index.html"><i class="layui-icon layui-icon-house-shop"></i><span
                    class="layui-badge totalNum"></span></a>
            </div>
        <ul class="layui-nav close">
            <li class="layui-nav-item layui-this"><a href="../index.html">首页</a></li>
            <li class="layui-nav-item "><a href="../all/index.html">所有商品</a></li>
<!--            <li class="layui-nav-item "><a href="/device/">小家电</a></li>-->
<!--            <li class="layui-nav-item "><a href="/wash/">洗护</a></li>-->
<!--            <li class="layui-nav-item "><a href="/kitchen/">厨具</a></li>-->
<!--            <li class="layui-nav-item "><a href="/supplies/">日用品</a></li>-->
        </ul>
        <button id="switch"><span></span><span class="second"></span><span class="third"></span></button>
    </div>
</div>
<div class="layui-container house-detail"><p class="title"><a href='../index.html'>首页</a> > <span>产品详情</span>
</p>
    <div class="layui-row price">
        <div class="layui-col-sm6">
            <div class="intro-img"><img id="cover" src="../uploads/allimg/200102/1-15Ma3555-H13.jpg"></div>
        </div>
        <form id="formcar" name="formcar" onsubmit="return false">
            <input type="hidden" id="good_id" name="good_id" value="4">
            <div class="layui-col-sm6 shopChoose" >
                <div class="title layui-form">
                    <p><label id="good_title"></label></p>&nbsp; <span></span></div>
                <p><span>￥<big><b id="GOODS_AMOUNT"><label id="good_price"></label></b></big></span>
                    </big></p>
                <dl>
                    <dt>规格：</dt>
                    <dd class="active" onclick='' title='¥ '><label id="good_specs"></label><input style='display:none'
                                                                                                   id='specs'
                                                                                                   type='radio' checked>
                    </dd>
                </dl>
                <dl>
                    <dt>库存：</dt>
                    <label id="good_num"></label>
                </dl>
                <div class="number layui-form"><label>数量</label>
                    <div class="layui-input-inline btn-input">
                        <button class="layui-btn layui-btn-primary sup" type="button"
                                onclick="goods_cut(),changePrice()">-
                        </button>
                        <input type="text" class="layui-input" name="buynum" id="number" value="1"
                               onblur="changePrice()">
                        <button class="layui-btn layui-btn-primary sub" type="button"
                                onclick="goods_add(),changePrice()">+
                        </button>
                    </div>
                    <p class="inputTips"></p></div>
                <div class="shopBtn">
<!--                    <button class="layui-btn layui-btn-primary sale" id="buy_now">立即购买</button>-->
                    <button class="layui-btn shop " id="add_car"><i class="layui-icon layui-icon-house-shop"></i>加入购物车
                    </button>

                </div>
            </div>
        </form>
    </div>
    <div class="layui-row layui-col-space30">
        <div class="layui-col-sm12 detailTab">
            <div class="layui-tab layui-tab-brief">
                <ul class="layui-tab-title">
                    <li class="layui-this">详情</li>
                </ul>
                <div class="layui-tab-content " style="text-align: center">
                    <div class="layui-tab-item layui-show">
                        <p class="layui-colla-title">描述:
                            <label id="good_detail"></label>
                        </p>
                        <img id="detail_img" src="../res/static/img/goods_img3.jpg"/>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="house-footer">
    <div class="layui-container">
        <div class="intro"><span class="first"><i class="layui-icon layui-icon-house-shield"></i>7天无理由退换货</span> <span
                class="second"><i class="layui-icon layui-icon-house-car"></i>满99元全场包邮</span> <span class="third"><i
                class="layui-icon layui-icon-house-diamond"></i>100%品质保证</span> <span class="last"><i
                class="layui-icon layui-icon-house-tel"></i>客服400-8888-866</span></div>
        <div class="about"><span class="layui-breadcrumb" lay-separator="|"><a href="/about.html">关于我们</a><a
                href="/help.html">帮助中心</a><a href="/service.html">售后服务</a><a href="/delivery.html">配送服务</a><a
                href="/supply.html">关于货源</a></span>
            <p>织梦商城模板 版权所有 &copy; 2012-2020</p></div>
    </div>
</div>
<script src="../res/layui/layui.js"></script>
<script>
    var price = 0.1;
    var good_id = getQueryVariable('good_id');
    var total=0;
    console.log(good_id);

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }

    var my_token = getMyCookie('token');
    var my_user_id = getMyCookie('user_id');
    var username = getMyCookie('username');


    function getMyCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i].trim();
            if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
        }
        return "";
    }

    layui.use(['jquery', 'layer'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            good_id = getQueryVariable("good_id");

        $(document).ready(function () {
            document.getElementById("good_specs").innerText = '默认';
            $('#good_id').attr('value', good_id);
            $.ajax({
                url: "../../goodsController/Action/",
                data: {action: 'getGoodbyId', id: good_id},
                type: "get",
                anysc: true,
                dataType: "json",
                success: function (data) {
                    if (data.code == 200) {
                        console.log(data.data);
                        $('#cover').attr('src', data.data['cover']);
                        $('#good_id').attr('value', good_id);
                        $('#detail_img').attr('src', data.data['cover']);
                        price = data.data["price"];
                        total=data.data["num"];
                        document.getElementById("good_title").innerText = data.data["name"];
                        document.getElementById("good_price").innerText = data.data["price"];
                        if(data.data["specs"]!=''){
                            document.getElementById("good_specs").innerText = data.data["specs"];
                        }
                        document.getElementById("good_num").innerText = data.data["num"];
                        document.getElementById("good_detail").innerText = data.data["detail"];
                    } else {

                    }

                }
            })
        });

        $("#buy_now").click(function () {
            if (my_user_id == "" && my_token == "") {
                layer.msg('未登录');
                setTimeout(function (){
                    window.location.href="../member/login.html";
                }, 1000);
            }else{
                var num_val = document.getElementById('number').val();
                var new_num = num_val.value;
                if(new_num>total){
                    console.log(new_num)
                    console.log(total)
                    layer.msg('购买数量超出最大库存');
                    return false;
                }

            }
        });

    });


    function getSelectedAttributes(formBuy) {
        var spec_arr = 0;
        var j = 0;
        for (i = 0; i < formBuy.elements.length; i++) {
            var prefix = formBuy.elements[i].name.substr(0, 5);
            if (prefix == 'spec_' && (((formBuy.elements[i].type == 'radio' || formBuy.elements[i].type == 'checkbox') && formBuy.elements[i].checked) || formBuy.elements[i].tagName == 'SELECT')) {
                arr = formBuy.elements[i].value.split("|");
                spec_arr += parseInt(arr[0]);
                j++
            }
        }
        return spec_arr
    }

    function changePrice() {
        var trueprice = compute();
        document.getElementById('GOODS_AMOUNT').innerHTML = trueprice
    }

    function goods_cut() {
        var num_val = document.getElementById('number');
        var new_num = num_val.value;
        var Num = parseInt(new_num);
        if (Num > 1) Num = Num - 1;
        num_val.value = Num
    }

    function goods_add() {
        var num_val = document.getElementById('number');
        var new_num = num_val.value;
        var Num = parseInt(new_num);
        Num = Num + 1;
        num_val.value = Num
    }

    function changeAtt(t) {
        console.log(t);
        t.lastChild.checked = 'checked';
        for (var i = 0; i < t.parentNode.childNodes.length; i++) {
            if (t.parentNode.childNodes[i].className == 'cattsel') {
                t.parentNode.childNodes[i].className = ''
            }
        }
        t.className = "cattsel";
        changePrice()
    }

    function compute() {
        var num_val = document.getElementById('number').value;
        if (num_val < 1) {
            document.getElementById('number').value = 1;
            num_val = 1
        }
        var attrprice = getSelectedAttributes(document.forms['formcar']);
        price = isNaN(price) ? 0 : Number(price);
        attrprice = isNaN(attrprice) ? 0 : Number(attrprice);
        var trueprice = price + attrprice;
        return parseFloat(trueprice * num_val).toFixed(2)
    }

    onload = function () {
        changePrice()
    }
</script>

<script>layui.config({base: "../res/static/js/"}).use("house")</script>
<script type="text/javascript">
</script>
</body>
</html>